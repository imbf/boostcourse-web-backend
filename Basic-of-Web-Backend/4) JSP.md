## 1) JSP(JavaServer Pages)란?

### 간단한 JSP 실습

- **1에서 10까지 구하는 실습 코드**

- **sum10.jsp**

  ```jsp
  <!-- 페이지 지시자 -->
  <%@ page language="java" contentType="text/html; charset=UTF-8"
      pageEncoding="UTF-8"%>
  <!DOCTYPE html>
  <html>
  <head>
  <meta charset="UTF-8">
  <title>Insert title here</title>
  </head>
  <body>
  <!-- <% 자바 코드 %> 자바코드가 들어 있다는 것을 알려주는 태그 -->   
  <%
  	int total = 0;
  	for (int i = 1; i <= 10; i++) {
  		total = total + i;
  	}
  %>
  
  1부터 10까지의 합: <%= total %>
  </body>
  </html>
  ```

### 모든 JSP는 Servlet으로 바뀌어서 동작한다는 점에 집중해야 한다.

- **Servlet으로 변경된 sum10.jsp 파일**

  - **경로 :** `/Users/baejongjin/eclipse-workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp1/work/Catalina/localhost/firstweb/org/apache/jsp/jsp/sum10_jsp.java`

  ```java
  /*
   * Generated by the Jasper component of Apache Tomcat
   * Version: Apache Tomcat/8.5.61
   * Generated at: 2021-01-02 15:08:35 UTC
   * Note: The last modified time of this file was set to
   *       the last modified time of the source file after
   *       generation to assist with modification tracking.
   */
  package org.apache.jsp.jsp;
  
  import javax.servlet.*;
  import javax.servlet.http.*;
  import javax.servlet.jsp.*;
  
  public final class sum10_jsp extends org.apache.jasper.runtime.HttpJspBase
      implements org.apache.jasper.runtime.JspSourceDependent,
                   org.apache.jasper.runtime.JspSourceImports {
  
    private static final javax.servlet.jsp.JspFactory _jspxFactory =
            javax.servlet.jsp.JspFactory.getDefaultFactory();
  
    private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;
  
    private static final java.util.Set<java.lang.String> _jspx_imports_packages;
  
    private static final java.util.Set<java.lang.String> _jspx_imports_classes;
  
    static {
      _jspx_imports_packages = new java.util.HashSet<>();
      _jspx_imports_packages.add("javax.servlet");
      _jspx_imports_packages.add("javax.servlet.http");
      _jspx_imports_packages.add("javax.servlet.jsp");
      _jspx_imports_classes = null;
    }
  
    private volatile javax.el.ExpressionFactory _el_expressionfactory;
    private volatile org.apache.tomcat.InstanceManager _jsp_instancemanager;
  
    public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
      return _jspx_dependants;
    }
  
    public java.util.Set<java.lang.String> getPackageImports() {
      return _jspx_imports_packages;
    }
  
    public java.util.Set<java.lang.String> getClassImports() {
      return _jspx_imports_classes;
    }
  
    public javax.el.ExpressionFactory _jsp_getExpressionFactory() {
      if (_el_expressionfactory == null) {
        synchronized (this) {
          if (_el_expressionfactory == null) {
            _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
          }
        }
      }
      return _el_expressionfactory;
    }
  
    public org.apache.tomcat.InstanceManager _jsp_getInstanceManager() {
      if (_jsp_instancemanager == null) {
        synchronized (this) {
          if (_jsp_instancemanager == null) {
            _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
          }
        }
      }
      return _jsp_instancemanager;
    }
  
    public void _jspInit() {
    }
  
    public void _jspDestroy() {
    }
  
    public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {
  
      final java.lang.String _jspx_method = request.getMethod();
      if (!"GET".equals(_jspx_method) && !"POST".equals(_jspx_method) && !"HEAD".equals(_jspx_method) && !javax.servlet.DispatcherType.ERROR.equals(request.getDispatcherType())) {
        response.sendError(HttpServletResponse.SC_METHOD_NOT_ALLOWED, "JSPs only permit GET, POST or HEAD. Jasper also permits OPTIONS");
        return;
      }
  
      final javax.servlet.jsp.PageContext pageContext;
      javax.servlet.http.HttpSession session = null;
      final javax.servlet.ServletContext application;
      final javax.servlet.ServletConfig config;
      javax.servlet.jsp.JspWriter out = null;
      final java.lang.Object page = this;
      javax.servlet.jsp.JspWriter _jspx_out = null;
      javax.servlet.jsp.PageContext _jspx_page_context = null;
  
  
      try {
        response.setContentType("text/html; charset=UTF-8");
        pageContext = _jspxFactory.getPageContext(this, request, response,
        			null, true, 8192, true);
        _jspx_page_context = pageContext;
        application = pageContext.getServletContext();
        config = pageContext.getServletConfig();
        session = pageContext.getSession();
        out = pageContext.getOut();
        _jspx_out = out;
  
        out.write("\n");
        out.write("<!DOCTYPE html>\n");
        out.write("<html>\n");
        out.write("<head>\n");
        out.write("<meta charset=\"UTF-8\">\n");
        out.write("<title>Insert title here</title>\n");
        out.write("</head>\n");
        out.write("<body>\n");
  
  	int total = 0;
  	for (int i = 1; i <= 10; i++) {
  		total = total + i;
  	}
  
        out.write("\n");
        out.write("\n");
        out.write("1부터 10까지의 합: ");
        out.print( total );
        out.write("\n");
        out.write("</body>\n");
        out.write("</html>");
      } catch (java.lang.Throwable t) {
        if (!(t instanceof javax.servlet.jsp.SkipPageException)){
          out = _jspx_out;
          if (out != null && out.getBufferSize() != 0)
            try {
              if (response.isCommitted()) {
                out.flush();
              } else {
                out.clearBuffer();
              }
            } catch (java.io.IOException e) {}
          if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
          else throw new ServletException(t);
        }
      } finally {
        _jspxFactory.releasePageContext(_jspx_page_context);
      }
    }
  }
  ```

### JSP 등장 배경

- 마이크로소프트에서 ASP(Active Server Page)라는 쉽게 웹을 개발할 수 있는 스크립트(script) 엔진을 발표함 (1998년)
- 1997년에 발표된 서블릿은 ASP에 비하여 상대적으로 개발 방식이 불편함
- <u>ASP에 대항하기 위하여 1999년 썬마이크로시스템즈에서 JSP를 발표</u>
- **JSP는 실제로 서블릿 기술을 사용**
  - JSP는 항상 Servlet으로 바뀌고 바뀐 Servlet이 실행되는 것이다. 결국 JSP는 Servlet Lifecycle로써 실행된다.

### 생각해보기

1. **1부터 10까지의 합을 구하는 서블릿과 JSP를 비교해봤을 때 JSP가 어떤 부분에서 편리한것 같나요?**
   - 애노테이션 또는 xml으로 직접 Servlet을 설정할 필요도 없고, HttpServlet 구현체를 만들 필요도 없고, Response Header를 직접 로직으로 구성할 필요도 없고, HTML 파일을 직접 로직으로 구성할 필요가 없기 때문에 서블릿과 비교했을 때 매우 편리하다.

---

## 2) JSP 라이프싸이클

### sum10.jsp가 실행될 때 벌어지는 일

- 이클립스 워크스페이스 아래의 .metadata 폴더에 sum10_jsp.java 파일이 생성된다.
- 해당 파일의 _jspService() 메소드 안을 살펴 보면 jsp파일의 내용이 변환되서 들어가 있는 것을 확인할 수 있다.
- sum10_jsp.java는 서블릿 소스로 자동으로 컴파일 되면서 실행되서 그 결과가 브라우저에 보여진다.

### **JSP의 실행순서**

1. 브라우저가 웹서버에 JSP에 대한 요청 정보를 전달한다.
2. 브라우저가 요청한 JSP가 **최초**로 요청했을 경우만
   1.  JSP로 작성된 코드가 서블릿으로 코드로 변환한다. (java 파일 생성)
   2. 서블릿 코드를 컴파일해서 실행가능한 bytecode로 변환한다. (class 파일 생성)
   3. 서블릿 클래스를 로딩하고 인스턴스를 생성한다. (서블릿 객체 생성)
3. 서블릿이 실행되어 요청을 처리하고 응답 정보를 생성한다.

### JSP 라이프싸이클 실습

- JSP 라이프 싸이클을 확인할 lifecycle.jsp를 작성한 후 다음의 경우 어떤 결과가 나오는지 확인한다.
  - 브라우저로 최초 요청했을 때
  - 브라우저로 두 번째 요청했을 때
  - lifecycle.jsp를 수정한 후 요청했을 때

- 실습 코드

  ```jsp
  <%@ page language="java" contentType="text/html; charset=UTF-8"
      pageEncoding="UTF-8"%>
  <!DOCTYPE html>
  <html>
  <head>
  <meta charset="UTF-8">
  <title>Insert title here</title>
  </head>
  <body>
  hello~~
  <%
  	System.out.println("jspService()");
  %>
  
  <!-- 선언형 태그! -->
  <%!
  	public void jspInit() {
  		System.out.println("jspInit() changed");
  		/*  */
  	}
  %>
  
  <%!
  	public void jspDestory() {
  		System.out.println("jspDestory()");
  	}
  %>
  </body>
  </html>
  ```

### **생각해보기**

1. 서블릿 라이프 싸이클에서 실행되는 메소드와 JSP 라이프 싸이클에서 실행되는 메소드의 이름을 비교해 봅시다.
   - 서블릿 라이프 사이클에서 실행되는 메소드는 init, service, destroy가 존재하지만 추가적으로 JSP 라이프 사이클에서 실행되는 메소드로는 jspDestory, jspInit 등이 존재한다.
   - 즉 우리는 jsp파일 내에서 jspDestroy, jspInit 등을 오버라이딩 해서 사용할 수 있다. 위의 예제도 나의 플로우와 동일하다.

---

## 3) JSP 문법

### 스크립트 요소의 이해

- **JSP페이지에서는 선언문(Declaration), 스크립트릿(Scriptlet), 표현식(Expression) 이라는 3가지의 스크립트 요소를 제공**
  - **선언문(Declaration) - <%! %> : 전역변수 선언 및 메소드 선언에 사용**
  - **스크립트릿(Scriptlet) - <% %> : 프로그래밍 코드 기술에 사용**
  - **표현식(Expression) - <%=%> : 화면에 출력할 내용 기술에 사용**

### 선언문 (Declaration)

- **선언문: <%! %>**

- **선언문은 JSP페이지 내에서 필요한 멤버 변수나 메소드가 필요할 때 선언해 사용하는 요소**

- 선언문의 문법

  - <%! 문장 %>

- 선언문 예제 jsp 코드

  ```jsp
  <%@ page language="java" contentType="text/html; charset=UTF-8"
      pageEncoding="UTF-8"%>
  <!DOCTYPE html>
  <html>
  <head>
  <meta charset="UTF-8">
  <title>Insert title here</title>
  </head>
  <body>
  <%! 
  	String id = "u0001";
  	public String getId() {
  		return id;
  	}
  %>
  
  id : <%= this.getId() %>
  </body>
  </html>
  ```

  **실행 결과**

  <img src="/Users/baejongjin/Library/Application Support/typora-user-images/image-20210103093434570.png" alt="image-20210103093434570" style="zoom:50%;" />

### 스크립트릿(Scriptlet)

- **스크립트릿: <% %>**

- **가장 일반적으로 많이 쓰이는 스크립트 요소**

- **주로 프로그래밍의 로직을 기술할 때 사용.**

- **스크립트 릿에서 선언된 변수는 지역변수**

- 스크립트릿의 문법

  - <% 문장&>

- 스크립트릿 예제 jsp 코드

  ```jsp
  <%@ page language="java" contentType="text/html; charset=UTF-8"
      pageEncoding="UTF-8"%>
  <!DOCTYPE html>
  <html>
  <head>
  <meta charset="UTF-8">
  <title>Insert title here</title>
  </head>
  <body>
  <%
  	for(int i = 1; i <= 5; i++) {
  %>
  
  <H<%=i %>> 아름다운 한글 </H>
  
  <%
  	}
  %>
  </body>
  </html>
  ```

  **실행 결과**

  <img src="/Users/baejongjin/Library/Application Support/typora-user-images/image-20210103093923955.png" alt="image-20210103093923955" style="zoom:50%;" />

### 표현식(Expression)

- **표현식 : <%= %>**
- **JSP 페이지에서 웹 브라우저에 출력할 부분을 표현. 즉, 화면에 출력하기 위한 것**
- 스크립트냇에서 출력할 부분은 내장객체인 out 객체의 print() 또는 println() 메소드를 사용해서 출력
- 표현식의 문법
  - <%= 문장 %>

### 주석(Comment)

- JSP페이지에서 사용할 수 있는 주석
  - HTML 주석, 자바 주석, JSP 주석
- **HTML 주석**
  - HTML 주석은 \<!--로 시작해서 --> 로 끝나는 형태
  - HTML 주석은 HTML 주석을 사용한 페이지를 웹에서 서비스할 때 화면에 주석의 내용이 표시되지 않으나, [소스보기]를 수행하면 HTML 주석의 내용이 화면에 표시.
  - HTML 주석의 예시
    - \<!-- html 주석입니다. -->
- **JSP 주석**
  - JSP 페이지에서만 사용되며 <%--로 시작해서 --%>로 끝나는 형태
  - JSP 주석은 해당 페이지를, 웹 브라우저를 통해 출력 결과로서 표시하거나, 웹 브라우저 상에서 소스 보기를 해도 표시 되지 않음. 또한 JSP 주석 내에 실행코드를 넣어도 그 코드는 실행되지 않음.
  - JSP 주석의 예시
  - \<%-- JSP 주석입니다. --%>
- **자바 주석**
  - 자바 주석은 //, /**/을 사용해서 작성
    - //는 한 줄 주석
    - /* */ 는 여러 줄 주석
  - 스크립트이나 선언문에서 사용되는 주석으로, 자바와 주석 처리 방법이 같음
- 서블릿에서 자바 주석 및 html 주석은 보이나 jsp 주석은 보이지 않는다.
- html 페이지에서는 html 주석은 소스 코드로 보이나 jsp 주석이나 자바 주석은 보이지 않는다.

---

## 4) JSP 내장 객체(Implicit Objects)

### JSP 내장 객체란?

- **JSP를 실행하면 서블릿 객체가 생성되고 실행된다.**
- **JSP에 입력한 대부분의 코드는 생성되는 서블릿 소스의 _jspService() 메소드 안에 삽입되는 코드로 생성된다.**
- **_jspService()에 삽입된 코드의 윗 부분에 미리 선언된 객체들이 있는데, 해당 객체들은 jsp에서도 사용 가능하다.**
- **response, request, application, session, out과 같은 변수를 내장객체라고 한다.**

### JSP 내장 객체의 종류

![image-20210103095123748](/Users/baejongjin/Library/Application Support/typora-user-images/image-20210103095123748.png)

### 생각해보기

1. **내장객체를 JSP 선언문에서 사용할 수 있을까요? 사용할 수 없다면 왜 그럴까요?**
   - 선언문은 JSP에서 멤버 변수나 메소드가 필요할 때 선언하는 문장인데 여기서 사용할 수 있는 내장 객체들은 _jspService에 지역 변수로써 가지고 있다. 즉, 새로운 메소드와 멤버 변수는 _jspService 내의 지역 변수를 참조할 수 없기 때문에 사용할 수 없다.

